{% extends "find_pp2m/base_maps.html" %}


{% block content %}
    <body>
        <!-- Javascript files -->
        <script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js"
                integrity="sha512-/Nsx9X4HebavoBvEBuyp3I7od5tA0UzAxs+j83KgC8PU0kgB4XiK4Lfe4y4cgBtaRJQEIFCW+oC506aPT2L1zw=="
                crossorigin="">
        </script>
        <script type="text/javascript">
            var entities = {{ all_entities | safe }};
            var weightings = {{ weightings | safe }};
            var initial_cities = {{ initial_cities | safe }};
            var method = {{ method | safe }};

            if (method == 'route_duration') {
                var numformat = 2;
                var strmethod = 'par temps en voiture (temps moyen par personne)';
            } else if (method == 'route_distance') {
                var numformat = 1;
                var strmethod = 'par distance en voiture (distance moyenne par personne)';
            } else if (method == 'route_distance') {
                var numformat = 1;
                var strmethod = "par distance à vol d'oiseau (distance moyenne par personne)";
            }
        </script>

        <div>
            <p>Villes de départ:</p>
            <div id="InitialCitiesList" class="list"></div>
        </div>
        <script>
            var wrapper = document.getElementById("InitialCitiesList");
            var myHTML = '';
            for(var i = 0; i < initial_cities.length; i++) {
                myHTML += '<li>' + initial_cities[i]["fields"]["name"] + '</li>';
            }
            wrapper.innerHTML = myHTML;
        </script>

        <div id="map">
	        <!-- Map appears here -->
	    </div>

        {% load static %}
        <script type="text/javascript" src="{% static 'find_pp2m/js/map_with_weights.js' %}"></script>
        <script type="text/javascript">
            // Initialisation function
            window.onload = function(){
            initMap(macarte, entities, weightings, weighting_min, weighting_max, initial_cities);
            }
        </script>


        <div>
            <p>Résultats <script>document.write(strmethod)</script> :</p>
            <div id="TopResults" class="list"></div>
        </div>
        <script>
            var wrapper = document.getElementById("TopResults");
            var myHTML = '';
            for(var i = 0; i < 10; i++) {
                var composed_value = composeValue(entities[i]["fields"]["name"], weightings[i], method);
                myHTML += '<li>' + composed_value + '</li>';
            }
            wrapper.innerHTML = myHTML;
        </script>

    </body>
{% endblock %}

