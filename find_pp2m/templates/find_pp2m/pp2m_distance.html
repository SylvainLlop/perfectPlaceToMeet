{% extends "find_pp2m/base_maps.html" %}


{% block content %}
    <body>
        <!-- Javascript files -->
        <script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js"
                integrity="sha512-/Nsx9X4HebavoBvEBuyp3I7od5tA0UzAxs+j83KgC8PU0kgB4XiK4Lfe4y4cgBtaRJQEIFCW+oC506aPT2L1zw=="
                crossorigin="">
        </script>
        {% load static %}
        <script type="text/javascript" src="{% static 'find_pp2m/js/map_with_weights.js' %}"></script>
        <script type="text/javascript">
            var entities = {{ all_entities | safe }};
            var weightings = {{ weightings | safe }};
            var nbpeople = {{ nb_people | safe }};
            var initial_cities = {{ initial_cities | safe }};
            var method = {{ method | safe }};

            if (method == 'route_duration') {
                var numformat = 2;
                var strmethod = 'par temps en voiture';
                var straverage = 'Temps moyen par personne';
            } else if (method == 'route_distance') {
                var numformat = 1;
                var strmethod = 'par distance en voiture';
                var straverage = 'Distance moyenne par personne';
            } else if (method == 'route_distance') {
                var numformat = 1;
                var strmethod = "par distance à vol d'oiseau";
                var straverage = 'Distance moyenne par personne';
            }
        </script>

        <div>
            <p align="center">Résultats <script>document.write(strmethod)</script> :</p>
            <table id="TopResults" class="resultsTable" style="max-width:600px" align="center"></table>
        </div>
        <script>
            var wrapper = document.getElementById("TopResults");
            var myHTML = '<thead>';
            myHTML += '<td width="60%">Ville</td>';
            myHTML += '<td width="20%">' + straverage + '</td>';
            myHTML += '<td width="20%">Ecart</td>';
            myHTML += '</thead>';
            var i = 0;
            do {
                var composed_value = retrieveFormatedValue(weightings[i], method);
                var plusvalue = 100 * (weightings[i] - weightings[0]) / weightings[0];
                myHTML += '<tr>';
                myHTML += '<td align="center">' + entities[i]["fields"]["name"] + '</td>';
                myHTML += '<td align="center">' + composed_value + '</td>';
                if (i == 0) {
                    myHTML += '<td align="center">-</td>';
                } else {
                    myHTML += '<td align="center"> +' + plusvalue.toFixed(1) + '%</td>';
                }
                myHTML += '</tr>';
                if (i == 9) {
                    break;
                }
                i += 1;
            } while (weightings[i] < weightings[0] * 1.15)
            wrapper.innerHTML = myHTML;
        </script>

        <div id="map">
	        <!-- Map appears here -->
	    </div>
        <script type="text/javascript" src="{% static 'find_pp2m/js/map_with_weights.js' %}"></script>
        <script type="text/javascript">
            // Initialisation function
            window.onload = function(){
            initMap(macarte, entities, weightings, initial_cities);
            }
        </script>

        <div id="InitialCitiesList" align="center"></div>
        <script>
            var wrapper = document.getElementById("InitialCitiesList");
            var myHTML = 'Villes de départ: ';
            for(var i = 0; i < initial_cities.length; i++) {
                myHTML += initial_cities[i]["fields"]["name"] + ' (x' + nbpeople[i].toString() + '), ';
            }
            myHTML = myHTML.substring(0, myHTML.length - 2)
            wrapper.innerHTML = myHTML;
        </script>


    </body>
{% endblock %}

